# SpatialAddressPro 데이터 명세서

## 1. 개요

**시스템명**: SpatialAddressPro  
**목적**: AI 기반 주소 정규화 및 검색 시스템  
**데이터베이스**: PostgreSQL  
**총 레코드**: 약 641만 건 (기본주소) + 상세주소  

---

## 2. 테이블 구조

### 2.1 address_master (기본주소)

건물 단위의 도로명주소 정보를 저장하는 마스터 테이블

| 컬럼명             | 데이터타입 | NULL      | 설명                        | 예시                              |
| ------------------ | ---------- | --------- | --------------------------- | --------------------------------- |
| id                 | SERIAL     | NOT NULL  | Primary Key                 | 1                                 |
| mgmt_no            | VARCHAR    | UNIQUE    | 도로명주소관리번호 (연계키) | 4115010100100030005...            |
| si_nm              | VARCHAR    | -         | 시도명                      | 서울특별시                        |
| sgg_nm             | VARCHAR    | -         | 시군구명                    | 강남구                            |
| emd_nm             | VARCHAR    | -         | 읍면동명 (법정동)           | 역삼동                            |
| road_nm            | VARCHAR    | -         | 도로명                      | 테헤란로                          |
| buld_mainsn        | INTEGER    | -         | 건물본번                    | 152                               |
| buld_subsn         | INTEGER    | DEFAULT 0 | 건물부번                    | 0                                 |
| buld_nm            | VARCHAR    | NULL      | 건물명                      | 강남파이낸스센터                  |
| zip_no             | VARCHAR    | -         | 우편번호                    | 06236                             |
| road_full_addr     | VARCHAR    | -         | 전체 도로명주소             | 서울특별시 강남구 테헤란로 152    |
| jibun_full_addr    | VARCHAR    | -         | 전체 지번주소               | 서울특별시 강남구 역삼동 858      |
| si_nm_eng          | VARCHAR    | NULL      | 시도명 (영문)               | Seoul                             |
| sgg_nm_eng         | VARCHAR    | NULL      | 시군구명 (영문)             | Gangnam-gu                        |
| road_nm_eng        | VARCHAR    | NULL      | 도로명 (영문)               | Teheran-ro                        |
| road_full_addr_eng | VARCHAR    | NULL      | 전체 도로명주소 (영문)      | Teheran-ro 152, Gangnam-gu, Seoul |

**인덱스**:
- `ix_addr_search` (road_nm, buld_mainsn, emd_nm) - 도로명+번호 검색 최적화
- `ix_addr_eng_search` (road_nm_eng, buld_mainsn) - 영문 검색 최적화
- `ix_address_master_mgmt_no` (mgmt_no) - 연계키 검색

---

### 2.2 address_detail (상세주소)

건물 내 동/층/호 정보를 저장하는 상세 테이블

| 컬럼명      | 데이터타입 | NULL        | 설명                        | 예시                   |
| ----------- | ---------- | ----------- | --------------------------- | ---------------------- |
| id          | SERIAL     | NOT NULL    | Primary Key                 | 1                      |
| mgmt_no     | VARCHAR    | -           | 도로명주소관리번호 (연계키) | 4115010100100030005... |
| dong        | VARCHAR    | NULL        | 동명칭                      | 101동                  |
| floor       | VARCHAR    | NULL        | 층명칭                      | 5층                    |
| ho          | VARCHAR    | NULL        | 호명칭                      | 501호                  |
| ho_detail   | VARCHAR    | NULL        | 호점미사명칭 (호 상세구분)  | A, B                   |
| is_basement | VARCHAR    | DEFAULT '0' | 지하여부 (0:일반, 1:지하)   | 0                      |
| detail_full | VARCHAR    | NULL        | 전체 상세주소 문자열        | 101동 5층 501호        |

**인덱스**:
- `ix_detail_search` (mgmt_no, dong, ho) - 상세주소 검색 최적화

**관계**: address_master.mgmt_no ↔ address_detail.mgmt_no (1:N)

---

## 3. 데이터 소스

### 3.1 원천 데이터 (행정안전부 도로명주소 전체분)

| 파일 유형  | 파일명 패턴            | 설명                                 |
| ---------- | ---------------------- | ------------------------------------ |
| 기본주소   | 주소_*.txt             | 도로명주소 기본 정보                 |
| 도로명코드 | *도로명코드_전체분.txt | 도로명코드 ↔ 시도/시군구/도로명 매핑 |
| 부가정보   | 부가정보_*.txt         | 건물명 정보                          |
| 지번정보   | 지번_*.txt             | 지번번호, **법정동명**               |
| 영문주소   | 영문/rneng_*.txt       | 영문 도로명주소                      |
| 상세주소   | rns*.txt               | 동/층/호 정보                        |

### 3.2 지역별 파일 목록

| 지역           | 주소 파일               | 영문 파일           | 상세주소 파일              |
| -------------- | ----------------------- | ------------------- | -------------------------- |
| 서울특별시     | 주소_서울특별시.txt     | rneng_seoul.txt     | rnspbd_adrdc_seoul.txt     |
| 부산광역시     | 주소_부산광역시.txt     | rneng_busan.txt     | rnspbd_adrdc_busan.txt     |
| 대구광역시     | 주소_대구광역시.txt     | rneng_daegu.txt     | rnspbd_adrdc_daegu.txt     |
| 인천광역시     | 주소_인천광역시.txt     | rneng_incheon.txt   | rnspbd_adrdc_incheon.txt   |
| 광주광역시     | 주소_광주광역시.txt     | rneng_gwangju.txt   | rnspbd_adrdc_gwangju.txt   |
| 대전광역시     | 주소_대전광역시.txt     | rneng_daejeon.txt   | rnspbd_adrdc_daejeon.txt   |
| 울산광역시     | 주소_울산광역시.txt     | rneng_ulsan.txt     | rnspbd_adrdc_ulsan.txt     |
| 세종특별자치시 | 주소_세종특별자치시.txt | rneng_sejong.txt    | rnspbd_adrdc_sejong.txt    |
| 경기도         | 주소_경기도.txt         | rneng_gyunggi.txt   | rnspbd_adrdc_gyunggi.txt   |
| 강원특별자치도 | 주소_강원특별자치도.txt | rneng_gangwon.txt   | rnspbd_adrdc_gangwon.txt   |
| 충청북도       | 주소_충청북도.txt       | rneng_chungbuk.txt  | rnspbd_adrdc_chungbuk.txt  |
| 충청남도       | 주소_충청남도.txt       | rneng_chungnam.txt  | rnspbd_adrdc_chungnam.txt  |
| 전북특별자치도 | 주소_전북특별자치도.txt | rneng_jeonbuk.txt   | rnspbd_adrdc_jeonbuk.txt   |
| 전라남도       | 주소_전라남도.txt       | rneng_jeonnam.txt   | rnspbd_adrdc_jeonnam.txt   |
| 경상북도       | 주소_경상북도.txt       | rneng_gyeongbuk.txt | rnspbd_adrdc_gyeongbuk.txt |
| 경상남도       | 주소_경상남도.txt       | rneng_gyeongnam.txt | rnspbd_adrdc_gyeongnam.txt |
| 제주특별자치도 | 주소_제주특별자치도.txt | rneng_jeju.txt      | rnspbd_adrdc_jeju.txt      |

---

## 4. Import 프로세스

### 4.1 데이터 로드 순서

```
1. load_road_code_map()     → 도로명코드 전체분 로드 (Global)
2. load_extra_info()        → 부가정보 로드 (Region별)
3. load_jibun_info()        → 지번정보 + 법정동명 로드 (Region별)
4. load_english_info()      → 영문주소 로드 (Region별)
5. import_addresses()       → 기본주소 Import
6. load_all_detail_addresses() → 상세주소 Import
```

### 4.2 핵심 매핑 로직

```python
# 1. 도로명코드 → 시도/시군구/도로명 (대표 동)
road_map[road_code] = {
    "sido": "경기도",
    "sgg": "광명시", 
    "road": "오리로",
    "emd": "일직동"  # 대표 동 (부정확할 수 있음)
}

# 2. 지번정보 → 정확한 법정동
jibun_map[mgmt_no] = {
    "jibun": "864",
    "emd": "하안동"  # ★ 정확한 법정동 (이것을 사용!)
}

# 3. 최종 emd 결정
emd = jibun_data["emd"] if jibun_data["emd"] else road_map["emd"]
```

---

## 5. 주요 변경 이력

| 일자       | 변경 내용                                      |
| ---------- | ---------------------------------------------- |
| 2024-12-19 | 초기 스키마 설계 및 Import 구현                |
| 2024-12-19 | 영문주소 컬럼 추가                             |
| 2024-12-19 | 상세주소(address_detail) 테이블 추가           |
| 2024-12-19 | mgmt_no 연계키 추가                            |
| 2024-12-21 | 법정동(emd_nm) 정확도 개선 - 지번파일에서 추출 |
| 2024-12-22 | 특례시 지원 추가 (수원, 용인, 고양, 창원)      |

---

## 6. 검색 기능

### 6.1 검색 전략 (우선순위)

1. **도로명 + 건물번호** - 가장 정확 (`오리로 801`)
2. **도로명만** - 번호 없을 때 (`오리로`)
3. **건물명** - 아파트/빌딩 검색 (`우림라이온스밸리`)
4. **Fallback** - 전체 텍스트 검색

### 6.2 공백 없는 입력 처리

```
Input:  "부산광역시남구수영로305"
Output: "부산광역시 남구 수영로 305"
```

자동으로 행정구역 경계(시/도/구/군/로/길)에서 공백 삽입

### 6.3 특례시 지원

2022년부터 인구 100만 이상 대도시에 **특례시** 지위가 부여되었습니다.
시스템은 특례시와 일반시 명칭을 **양방향 자동 매핑**합니다.

| 특례시명   | 일반시명 | 소속 도  |
| ---------- | -------- | -------- |
| 수원특례시 | 수원시   | 경기도   |
| 용인특례시 | 용인시   | 경기도   |
| 고양특례시 | 고양시   | 경기도   |
| 창원특례시 | 창원시   | 경상남도 |

**검색 예시**:
```
입력: "경기도 수원시 팔달구 ..."
검색: sgg_nm LIKE '%수원시%' OR sgg_nm LIKE '%수원특례시%'
결과: 수원시 또는 수원특례시 모두 매칭
```

---

## 7. 참고사항

- **인코딩**: CP949 (원천 데이터), UTF-8 (시스템)
- **구분자**: 파이프(|)
- **데이터 갱신 주기**: 월 1회 (행정안전부 공개 일정)
- **데이터 출처**: [주소정보누리집](https://www.juso.go.kr)
- **특례시 제도**: 2022년 1월 시행 (지방자치법 개정)

